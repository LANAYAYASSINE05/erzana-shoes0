{%- comment -%}
  Snippet qui génère automatiquement le menu de navigation avec les collections Erzana Shoes
  Utilise directement les handles de collections sans passer par Shopify Admin
{%- endcomment -%}

{% liquid
  # Handles des collections Erzana Shoes (ordre d'affichage dans le menu)
  assign collection_handles = 'bottes-bottines,chaussures-de-ville,chaussures-classiques,chaussures-confort' | split: ','
  assign menu_content_type = block_settings.menu_style | default: 'text'
  assign image_border_radius = block_settings.image_border_radius
  assign color_scheme_setting_id = 'color_scheme_' | append: section.settings.menu_row
  assign current_color_scheme = block_settings.color_scheme
  assign parent_color_scheme = section.settings[color_scheme_setting_id]

  if parent_color_scheme.id != current_color_scheme.id
    assign color_scheme_classes = ' color-' | append: current_color_scheme
  endif

  if parent_color_scheme.settings.background.rgb == current_color_scheme.settings.background.rgb
    assign color_scheme_classes = color_scheme_classes | append: ' color-scheme-matches-parent'
  endif

  if block_settings.menu_style == 'featured_collections'
    assign ratio = block_settings.featured_collections_aspect_ratio
  elsif block_settings.menu_style == 'featured_products'
    assign ratio = block_settings.featured_products_aspect_ratio
  endif
%}

{% capture children %}
  {% for handle in collection_handles %}
    {% assign collection = collections[handle] %}
    {% if collection != blank %}
      <li
        role="presentation"
        class="menu-list__list-item"
        on:focus="/activate"
        on:blur="/deactivate"
        on:pointerenter="/activate"
        on:pointerleave="/deactivate"
      >
        <a
          href="{{ collection.url }}"
          data-skip-node-update="true"
          class="menu-list__link{% if collection.handle == collection.handle %} menu-list__link--active{% endif %}"
          {% if collection.handle == collection.handle %}aria-current="page"{% endif %}
          ref="menuitem"
        >
          <span class="menu-list__link-title">{{ collection.title }}</span>
        </a>
        {%- if menu_content_type != 'text' and collection.products_count > 0 -%}
          <div class="menu-list__submenu{{ color_scheme_classes }}" ref="submenu[]">
            <div
              id="submenu-{{ forloop.index }}"
              class="menu-list__submenu-inner"
              style="{% render 'submenu-font-styles', settings: block_settings %}"
            >
              {% assign list_id = 'MegaMenuList-' | append: forloop.index %}
              {%- comment -%} Mega menu pour collection {%- endcomment -%}
              <div class="mega-menu__grid">
                {% for product in collection.products limit: 4 %}
                  <div class="mega-menu__column">
                    <a href="{{ product.url }}" class="mega-menu__link">
                      {% if product.featured_image %}
                        <img
                          src="{{ product.featured_image | image_url: width: 200 }}"
                          alt="{{ product.title }}"
                          class="mega-menu__link-image"
                          loading="lazy"
                        >
                      {% endif %}
                      <span>{{ product.title }}</span>
                    </a>
                  </div>
                {% endfor %}
              </div>
            </div>
          </div>
        {%- endif -%}
      </li>
    {% endif %}
  {% endfor %}
  <li
    class="menu-list__list-item"
    role="presentation"
    slot="more"
    on:focus="/activate"
    on:blur="/deactivate"
    on:pointerenter="/activate"
    on:pointerleave="/deactivate"
  >
    <button role="menuitem" class="button menu-list__link button-unstyled">
      <span class="menu-list__link-title">{{ 'actions.more' | t }}</span>
    </button>
  </li>
{% endcapture %}

<nav header-menu>
  <div
    class="menu-list"
    style="{% render 'menu-font-styles', settings: block_settings %}"
  >
    {% assign class = 'overflow-menu' | append: color_scheme_classes %}
    {% render 'overflow-list', class: class, ref: 'overflowMenu', children: children, minimum-items: 2, defer: true %}
  </div>
</nav>

